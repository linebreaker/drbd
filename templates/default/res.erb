# Generated by Chef for <%= node[:fqdn] %>
protocol C;

handlers {
        pri-on-incon-degr "echo o > /proc/sysrq-trigger ; halt -f";
        pri-lost-after-sb "echo o > /proc/sysrq-trigger ; halt -f";
        local-io-error "echo o > /proc/sysrq-trigger ; halt -f";
        <% if @has_heartbeat %>
          outdate-peer "/usr/lib/heartbeat/drbd-peer-outdater -t 5";
        <% end %>
}

startup {
        degr-wfc-timeout 120;
}

disk {
        on-io-error detach;
}

net {
        cram-hmac-alg sha1;
        shared-secret "<%= @my_master %>";
        after-sb-0pri disconnect;
        after-sb-1pri disconnect;
        after-sb-2pri disconnect;
        rr-conflict disconnect;
}

syncer {
        rate 1000M;
        verify-alg sha1;
        al-extents 257;
}

resource <%= @resource %> {
  device    <%= node['drbd']['dev'] %>;
  disk      <%= node['drbd']['disk'] %>;
  meta-disk internal;
  on <%= node.name %> {
    address   <%= node.ipaddress %>:<%= node['drbd']['port'] %>;
  }
  on <%= node['drbd']['remote_host'] %> {
    address   <%= @remote_ip %>:<%= node['drbd']['port'] %>;
  }
}
